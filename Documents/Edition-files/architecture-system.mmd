---
config:
  theme: dark
  look: classic
  layout: elk
---
flowchart TB
 subgraph CLIENT["{{CLIENT_LAYER}}"]
        BLAZOR["Blazor WebAssembly<br>{{COMPONENTS}}"]
        STATE["{{STATE_MANAGEMENT}}"]
  end
 subgraph PRESENTATION["{{LAYER_PRESENTATION}}"]
        API["API Controllers<br>{{REST_ENDPOINTS}}"]
        AUTH_FILTER["{{AUTH_FILTERS}}"]
        VALIDATION["{{INPUT_VALIDATION}}"]
  end
 subgraph APPLICATION["{{LAYER_APPLICATION}}"]
        USER_SVC["{{SERVICE_USER}}"]
        TICKET_SVC["{{SERVICE_TICKET}}"]
        COMMENT_SVC["{{SERVICE_COMMENT}}"]
        NOTIF_SVC["{{SERVICE_NOTIFICATION}}"]
        LOG_SVC["{{SERVICE_LOG}}"]
        MEDIATOR["MediatR<br>{{CQRS_PATTERN}}"]
  end
 subgraph DOMAIN["{{LAYER_DOMAIN}}"]
        USER_ENTITY["{{ENTITY_USER}}"]
        TICKET_ENTITY["{{ENTITY_TICKET}}"]
        COMMENT_ENTITY["{{ENTITY_COMMENT}}"]
        LOG_ENTITY["{{ENTITY_LOG}}"]
        INTERFACES["{{DOMAIN_INTERFACES}}"]
        BUSINESS_RULES["{{BUSINESS_RULES}}"]
  end
 subgraph INFRASTRUCTURE["{{LAYER_INFRASTRUCTURE}}"]
        EF_CONTEXT["EF Core DbContext"]
        REPOSITORIES["{{REPOSITORIES}}"]
        USER_REPO["{{REPO_USER}}"]
        REPO_TICKET["{{REPO_TICKET}}"]
        REPO_COMMENT["{{REPO_COMMENT}}"]
        LOG_REPO["{{REPO_LOG}}"]
  end
 subgraph SECURITY["{{SECURITY_LAYER}}"]
        JWT["JWT {{TOKENS}}"]
        IDENTITY["ASP.NET Identity"]
        AUTH["{{AUTHENTICATION}}"]
        AUTHZ["{{AUTHORIZATION}}"]
  end
 subgraph PERSISTENCE["{{PERSISTENCE_LAYER}}"]
        SQL_DB[("SQL Server<br>{{DATABASE}}")]
  end
    BLAZOR --> STATE & API
    API --> AUTH_FILTER & VALIDATION & MEDIATOR
    MEDIATOR --> USER_SVC & TICKET_SVC & COMMENT_SVC & NOTIF_SVC & LOG_SVC
    USER_ENTITY --> BUSINESS_RULES
    TICKET_ENTITY --> BUSINESS_RULES
    COMMENT_ENTITY --> BUSINESS_RULES
    REPOSITORIES --> USER_REPO & REPO_TICKET & REPO_COMMENT & LOG_REPO
    USER_REPO --> EF_CONTEXT
    REPO_TICKET --> EF_CONTEXT
    REPO_COMMENT --> EF_CONTEXT
    LOG_REPO --> EF_CONTEXT
    IDENTITY --> JWT
    AUTH --> IDENTITY
    AUTHZ --> IDENTITY
    STATE -. {{HTTP_REQUESTS}} .-> API
    AUTH_FILTER --> AUTH
    VALIDATION --> APPLICATION
    USER_SVC --> USER_ENTITY
    TICKET_SVC --> TICKET_ENTITY
    COMMENT_SVC --> COMMENT_ENTITY
    LOG_SVC --> LOG_ENTITY
    INTERFACES -. {{IMPLEMENTS}} .-> REPOSITORIES
    EF_CONTEXT --> SQL_DB
    SECURITY -. {{PROJECTS}} .-> API
    SECURITY -. {{VALIDATES}} .-> APPLICATION
    LOG_SVC -. {{AUDIT_TRAIL}} .-> LOG_REPO

     BLAZOR:::clientStyle
     STATE:::clientStyle
     API:::presentationStyle
     AUTH_FILTER:::presentationStyle
     VALIDATION:::presentationStyle
     USER_SVC:::applicationStyle
     TICKET_SVC:::applicationStyle
     COMMENT_SVC:::applicationStyle
     NOTIF_SVC:::applicationStyle
     LOG_SVC:::applicationStyle
     MEDIATOR:::applicationStyle
     USER_ENTITY:::domainStyle
     TICKET_ENTITY:::domainStyle
     COMMENT_ENTITY:::domainStyle
     LOG_ENTITY:::domainStyle
     INTERFACES:::domainStyle
     BUSINESS_RULES:::domainStyle
     EF_CONTEXT:::infraStyle
     REPOSITORIES:::infraStyle
     USER_REPO:::infraStyle
     REPO_TICKET:::infraStyle
     REPO_COMMENT:::infraStyle
     LOG_REPO:::infraStyle
     JWT:::securityStyle
     IDENTITY:::securityStyle
     AUTH:::securityStyle
     AUTHZ:::securityStyle
     SQL_DB:::dbStyle
    classDef clientStyle fill:#1e3a5f,stroke:#4a90e2,stroke-width:2px,color:#fff
    classDef presentationStyle fill:#2d5016,stroke:#7cb342,stroke-width:2px,color:#fff
    classDef applicationStyle fill:#4a148c,stroke:#9c27b0,stroke-width:2px,color:#fff
    classDef domainStyle fill:#b71c1c,stroke:#e53935,stroke-width:2px,color:#fff
    classDef infraStyle fill:#e65100,stroke:#ff9800,stroke-width:2px,color:#fff
    classDef securityStyle fill:#006064,stroke:#00acc1,stroke-width:2px,color:#fff
    classDef dbStyle fill:#1b5e20,stroke:#4caf50,stroke-width:2px,color:#fff